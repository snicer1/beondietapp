UPDATE receipts SET (grams) = (SELECT sum_gram FROM (SELECT sum(grams) sum_gram, receipts_id FROM receipt r, ingr_rec inrec WHERE r.id = inrec.receipts_id group by receipts_id) subselect WHERE receipts.id = subselect.receipts_id);

INSERT INTO ingr_rec (receipts_id, ingred_id, grams) VALUES (5, 9, 200)
INSERT INTO receipts (name, version, last_update, meal_type, grams, carbs, protein, fat, kcal) VALUES ('Shake', 1, CURRENT_DATE,'lunch',NULL,NULL,NULL,NULL,NULL);


UPDATE receipts SET (carbs, protein, fat, kcal) = (SELECT final_carbs, final_protein, final_fat,  final_kcal FROM (
    SELECT
    round(sum((inrec.grams * i.carbs)/100),2) final_carbs,
    round(sum((inrec.grams * i.protein)/100),2) final_protein,
    round(sum((inrec.grams * i.fat)/100),2) final_fat,
    round(sum((inrec.grams * i.kcal)/100),2) final_kcal,
    receipts_id
    FROM receipt r,
    ingredients i,
    ingr_rec inrec
    WHERE r.id = inrec.receipts_id and i.id = inrec.ingred_id
    group by receipts_id)
 subselect WHERE receipts.id = subselect.receipts_id);


